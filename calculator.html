<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCTV System Quote Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen p-4 sm:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-indigo-700">CCTV System Quote Generator</h1>
            <p class="text-gray-500 mt-2">Customize your system components to get a detailed estimate.</p>
        </header>

        <div class="max-w-6xl mx-auto space-y-8">

            <!-- Hardware Selection Card -->
            <div class="card bg-white p-6 rounded-xl border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">1. Camera Components</h2>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="py-3 px-6 w-1/3">Camera Model</th>
                                <th scope="col" class="py-3 px-6 w-1/6 text-center">Price (Unit)</th>
                                <th scope="col" class="py-3 px-6 w-1/6 text-center">Quantity</th>
                                <th scope="col" class="py-3 px-6 w-1/3 text-right">Line Total</th>
                            </tr>
                        </thead>
                        <tbody id="camera-list">
                            <!-- Camera rows will be injected here by JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="2" class="py-3 px-6 text-base font-semibold text-gray-800 text-right">Total Cameras:</td>
                                <td class="py-3 px-6 text-base font-bold text-indigo-600 text-center" id="total-camera-count">0</td>
                                <td class="py-3 px-6 text-base font-semibold text-gray-800 text-right" id="total-camera-cost">0.00</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <button onclick="addCameraRow()" class="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                    + Add Another Camera Type
                </button>
            </div>

            <!-- NVR and Hard Drive Card -->
            <div class="card bg-white p-6 rounded-xl border border-gray-100 grid md:grid-cols-2 gap-6">
                <div class="col-span-2">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">2. System Core Components</h2>
                </div>
                
                <!-- NVR Selection -->
                <div>
                    <label for="nvr-select" class="block text-sm font-medium text-gray-700 mb-2">Network Video Recorder (NVR)</label>
                    <select id="nvr-select" onchange="updateCalculation()" class="w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md border">
                        <!-- Options filled by JS -->
                    </select>
                    <div class="mt-2 text-sm text-gray-500">NVR Cost: <span id="nvr-cost" class="font-semibold text-gray-800">$0.00</span></div>
                </div>

                <!-- Hard Drive Selection -->
                <div>
                    <label for="hdd-select" class="block text-sm font-medium text-gray-700 mb-2">Surveillance Hard Drive (HDD)</label>
                    <select id="hdd-select" onchange="updateCalculation()" class="w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md border">
                        <!-- Options filled by JS -->
                    </select>
                    <div class="mt-2 text-sm text-gray-500">HDD Cost: <span id="hdd-cost" class="font-semibold text-gray-800">$0.00</span></div>
                </div>
            </div>

            <!-- Summary & Labor Card -->
            <div class="card bg-white p-6 rounded-xl border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">3. Final Estimate Summary</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Left: Line Item Totals -->
                    <div>
                        <div class="space-y-3">
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">Total Camera Hardware Cost:</span>
                                <span class="font-medium text-gray-800" id="subtotal-cameras">0.00</span>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">NVR & HDD Cost:</span>
                                <span class="font-medium text-gray-800" id="subtotal-system">0.00</span>
                            </div>
                            <div class="flex justify-between border-b pb-2 bg-yellow-50 p-2 rounded-md">
                                <span class="text-gray-900 font-semibold">Labor (Based on <span id="labor-camera-count" class="text-indigo-600">0</span> Cameras):</span>
                                <span class="font-bold text-red-600" id="total-labor">0.00</span>
                            </div>
                            <p class="text-xs text-gray-500 italic mt-1">
                                Labor cost is automatically adjusted based on the total quantity of cameras selected (progressive discount applied).
                            </p>
                        </div>
                    </div>

                    <!-- Right: Grand Total -->
                    <div class="flex flex-col items-end justify-center pt-4 md:pt-0 border-t md:border-t-0 md:border-l md:pl-6">
                        <div class="w-full max-w-xs space-y-4">
                            <div class="flex justify-between text-2xl font-extrabold text-indigo-700">
                                <span>GRAND TOTAL:</span>
                                <span id="grand-total">0.00</span>
                            </div>
                            <p class="text-sm text-gray-500 text-right">
                                All prices are estimated and do not include tax or miscellaneous materials (cable, conduit, etc.).
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        // --- DATA DEFINITIONS ---

        const CAMERAS = {
            'CAM-A1': { name: 'Dahua 6MP WizSense Turret 2.8mm Fixed Lens', price: 133.10 },
            'CAM-A2': { name: 'Dahua 6MP AcuPick Smart Dual Light Turret Camera 2.8mm', price: 157.30 },
            'CAM-A3': { name: 'Dahua IP 6MP Turret 2.8mm V4 TiOC 3.0 AcuPick', price: 256.30 },
            'CAM-A4': { name: 'Dahua 8MP Dual Light ACUPICK Turret Camera 2.8mm Fixed', price: 191.40 },
            'CAM-A5': { name: 'Dahua 8MP TiOC Turret 2.8mm AI V3', price: 272.25 },
            'CAM-A6': { name: 'Dahua 2x4MP TiOC Duo Splicing WizSense Turret Camera', price: 316.25 },
            'CAM-A7': { name: 'CAM-A7 (12MP 360Â° View)', price: 1000.00 },
            'CAM-A8': { name: 'CAM-A8 (Thermal Imaging, 3MP)', price: 1000.00 },
            'CAM-A9': { name: 'CAM-A9 (Mini Dome, Covert)', price: 1000.00 },
            'CAM-A10': { name: 'CAM-A10 (Outdoor Bullet, Varifocal)', price: 1000.00 },
            'CAM-B1': { name: 'CAM-B1 (2MP IP Box Camera)', price: 1000.00 },
            'CAM-B2': { name: 'CAM-B2 (4MP Mini PTZ)', price: 1000.00 },
            'CAM-B3': { name: 'CAM-B3 (8MP Corner Mount)', price: 1000.00 },
            'CAM-B4': { name: 'CAM-B4 (License Plate Recognition)', price: 1000.00 },
            'CAM-B5': { name: 'CAM-B5 (Wireless Battery Cam)', price: 1000.00 },
            'CAM-B6': { name: 'CAM-B6 (5MP Motorized Lens)', price: 1000.00 },
            'CAM-B7': { name: 'CAM-B7 (IP Intercom Station)', price: 1000.00 },
            'CAM-B8': { name: 'CAM-B8 (Explosion-proof Housing)', price: 1200.00 },
            'CAM-B9': { name: 'CAM-B9 (3MP Mini Turret)', price: 1000.00 },
            'CAM-B10': { name: 'CAM-B10 (4MP Indoor Cube)', price: 1000.00 },
        };

        const NVRS = {
            'NVR-4CH': { name: '4-Channel Standard NVR', price: 211.20 },
            'NVR-8CH': { name: '8-Channel Pro NVR', price: 266.20 },
            'NVR-16CH': { name: '16-Channel Enterprise NVR', price: 528.00 },
        };

        const HDDS = {
            'HDD-2TB': { name: '2TB Surveillance Hard Drive', price: 116.60 },
            'HDD-3TB': { name: '3TB Surveillance Hard Drive', price: 155.32 },
            'HDD-4TB': { name: '4TB Surveillance Hard Drive', price: 155.32 },
            'HDD-6TB': { name: '6TB Surveillance Hard Drive', price: 271.81 },
            'HDD-8TB': { name: '8TB Surveillance Hard Drive', price: 375.65 },
            'HDD-10TB': { name: '10TB Surveillance Hard Drive', price: 631.54 },
        };

        // Labor cost table based on total number of cameras
        const LABOR_COSTS = [
            0,    // Index 0: 0 cameras
            200,  // Index 1: 1 camera
            300,  // Index 2: 2 cameras
            380,  // Index 3: 3 cameras
            439.8,  // Index 4: 4 cameras
            531.7,  // Index 5: 5 cameras
            618.6,  // Index 6: 6 cameras
            690,  // Index 7: 7 cameras
            760   // Index 8: 8 cameras (Note: 700 for 8 cameras is slightly less than 702 for 7, keeping as per user request)
        ];

        // --- HELPER FUNCTIONS ---

        /**
         * Calculates the total labor cost based on the total number of cameras.
         * Applies the progressive cost structure.
         */
        function calculateLaborCost(count) {
            if (count === 0) return 0;

            const MAX_INDEX = LABOR_COSTS.length - 1; // 8
            const MAX_CAM_COST = LABOR_COSTS[MAX_INDEX]; // $700

            if (count <= MAX_INDEX) {
                return LABOR_COSTS[count];
            } else {
                // For 9+ cameras, use the 8-camera baseline cost and add a marginal rate ($85 per camera after 8)
                const extraCameras = count - MAX_INDEX;
                const marginalRate = 85.00;
                return MAX_CAM_COST + (extraCameras * marginalRate);
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
            }).format(amount);
        }

        // --- UI INJECTION FUNCTIONS ---

        function createCameraDropdown(index, selectedKey) {
            let html = `<select data-index="${index}" onchange="updateRow(this)" class="w-full p-2 border border-gray-300 rounded-md bg-white focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">`;
            html += '<option value="" disabled ' + (selectedKey ? '' : 'selected') + '>-- Select Camera --</option>';
            
            Object.keys(CAMERAS).forEach(key => {
                const camera = CAMERAS[key];
                const isSelected = key === selectedKey ? 'selected' : '';
                html += `<option value="${key}" data-price="${camera.price}" ${isSelected}>${camera.name} (${formatCurrency(camera.price)})</option>`;
            });

            html += '</select>';
            return html;
        }
        
        function populateStaticDropdowns() {
            // NVR
            const nvrSelect = document.getElementById('nvr-select');
            Object.keys(NVRS).forEach(key => {
                const nvr = NVRS[key];
                const option = new Option(`${nvr.name} (${formatCurrency(nvr.price)})`, key);
                option.dataset.price = nvr.price;
                nvrSelect.add(option);
            });
            // Select the 8-Channel NVR by default if it exists
            nvrSelect.value = 'NVR-8CH'; 

            // HDD
            const hddSelect = document.getElementById('hdd-select');
            Object.keys(HDDS).forEach(key => {
                const hdd = HDDS[key];
                const option = new Option(`${hdd.name} (${formatCurrency(hdd.price)})`, key);
                option.dataset.price = hdd.price;
                hddSelect.add(option);
            });
            // Select 4TB by default
            hddSelect.value = 'HDD-4TB';
        }

        // --- DYNAMIC TABLE MANAGEMENT ---

        let cameraRows = [];

        function addCameraRow() {
            const index = cameraRows.length;
            cameraRows.push({ cameraKey: '', quantity: 0, unitPrice: 0, lineTotal: 0 });

            const row = document.createElement('tr');
            row.id = `row-${index}`;
            row.className = 'bg-white border-b hover:bg-gray-50';
            row.innerHTML = `
                <td class="py-2 px-6">
                    ${createCameraDropdown(index)}
                </td>
                <td class="py-2 px-6 text-center font-medium text-gray-900" id="unit-price-${index}">
                    $0.00
                </td>
                <td class="py-2 px-6">
                    <input type="number" min="0" value="0" data-index="${index}" oninput="updateRow(this)"
                        class="w-full text-center p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </td>
                <td class="py-2 px-6 text-right font-bold text-gray-900" id="line-total-${index}">
                    $0.00
                </td>
            `;

            document.getElementById('camera-list').appendChild(row);
            updateCalculation();
        }

        function updateRow(element) {
            const index = element.dataset.index;
            const rowData = cameraRows[index];
            
            // 1. Update Camera Type (if select changed)
            if (element.tagName === 'SELECT') {
                const selectedOption = element.options[element.selectedIndex];
                const cameraKey = selectedOption.value;
                const unitPrice = parseFloat(selectedOption.dataset.price) || 0;

                rowData.cameraKey = cameraKey;
                rowData.unitPrice = unitPrice;

                document.getElementById(`unit-price-${index}`).textContent = formatCurrency(unitPrice);
            }

            // 2. Update Quantity (if input changed)
            if (element.tagName === 'INPUT') {
                rowData.quantity = parseInt(element.value) || 0;
            }

            // 3. Calculate Line Total
            rowData.lineTotal = rowData.unitPrice * rowData.quantity;
            document.getElementById(`line-total-${index}`).textContent = formatCurrency(rowData.lineTotal);

            // 4. Trigger main calculation
            updateCalculation();
        }


        // --- MAIN CALCULATION LOGIC ---

        function updateCalculation() {
            let totalCameraCount = 0;
            let subtotalCameraCost = 0;

            // 1. Calculate Camera Totals
            cameraRows.forEach(row => {
                totalCameraCount += row.quantity;
                subtotalCameraCost += row.lineTotal;
            });
            
            // 2. Calculate NVR Cost
            const nvrSelect = document.getElementById('nvr-select');
            const selectedNvrOption = nvrSelect.options[nvrSelect.selectedIndex];
            const nvrCost = parseFloat(selectedNvrOption.dataset.price) || 0;

            // 3. Calculate HDD Cost
            const hddSelect = document.getElementById('hdd-select');
            const selectedHddOption = hddSelect.options[hddSelect.selectedIndex];
            const hddCost = parseFloat(selectedHddOption.dataset.price) || 0;

            const subtotalSystemCost = nvrCost + hddCost;

            // 4. Calculate Labor Cost
            const totalLaborCost = calculateLaborCost(totalCameraCount);

            // 5. Calculate Grand Total
            const grandTotal = subtotalCameraCost + subtotalSystemCost + totalLaborCost;

            // 6. Update UI Elements
            document.getElementById('total-camera-count').textContent = totalCameraCount;
            document.getElementById('labor-camera-count').textContent = totalCameraCount;

            document.getElementById('subtotal-cameras').textContent = formatCurrency(subtotalCameraCost);
            document.getElementById('subtotal-system').textContent = formatCurrency(subtotalSystemCost);
            
            document.getElementById('nvr-cost').textContent = formatCurrency(nvrCost);
            document.getElementById('hdd-cost').textContent = formatCurrency(hddCost);

            document.getElementById('total-labor').textContent = formatCurrency(totalLaborCost);
            document.getElementById('grand-total').textContent = formatCurrency(grandTotal);
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            populateStaticDropdowns();
            // Add four default rows to start the calculator
            addCameraRow();
            addCameraRow();
            addCameraRow(); // Added two more rows
            addCameraRow(); // Added two more rows
            // Trigger calculation one last time after initialization
            updateCalculation();
        };

    </script>
</body>
</html>